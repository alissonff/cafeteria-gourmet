<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Carrinho de Compras</title>
    <!-- Link to CSS files -->
    <link rel="stylesheet" href="cart.css">
</head>
<body>
    <h1>Carrinho de Compras</h1>
    <div id="cart-items">
        <!-- Cart items will be listed here -->

    </div>
    <div>
        <button id="checkout-button">Finalizar Compra</button>
    </div>
    <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Fetch and display cart items
                    fetchCartItems();

                    // Event delegation for handling dynamic content (like remove buttons)
                    document.getElementById('cart-items').addEventListener('click', function(event) {
                        if (event.target.classList.contains('remove-button')) {
                            const itemId = event.target.dataset.itemId;
                            removeFromCart(itemId);
                        }
                    });
                });

                function fetchCartItems() {
                    fetch('/api/cart')
                        .then(response => response.json())
                        .then(cartItems => {
                            displayCartItems(cartItems);
                        })
                        .catch(error => console.error('Error fetching cart items:', error));
                }

                function displayCartItems(cartItems) {
                    const cartContainer = document.getElementById('cart-items');
                    cartContainer.innerHTML = ''; // Clear current contents

                    cartItems.forEach(item => {
                        // Create and append each cart item element
                        // Adjust this part based on your HTML structure
                        const itemElement = `
                            <div class="cart-item">
                                <div class="item-details">
                                    <img src="${item.imageUrl}" class="item-image">
                                    <div class="item-title">${item.title}</div>
                                </div>
                                <div class="item-price">${item.price}</div>
                                <button class="remove-button" data-item-id="${item.id}">Remove</button>
                            </div>
                        `;
                        cartContainer.innerHTML += itemElement;
                    });
                }

                function removeFromCart(itemId) {
                    fetch(`/api/cart/remove`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ itemId: itemId })
                    })
                    .then(response => {
                        if (response.ok) {
                            fetchCartItems(); // Refresh the cart items
                        } else {
                            console.error('Failed to remove item from cart');
                        }
                    })
                    .catch(error => console.error('Error removing item from cart:', error));
                }


    </script>
</body>
</html>
